<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta http-equiv=" X-UA-Compatible" content="ie=edge">

    <title>HabiTrack</title>

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="HabiTrack">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/img/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/img/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/img/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/img/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/img/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/img/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/img/apple-touch-icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon-180x180.png" />

    <link href="/img/splashscreens/iphone5_splash.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
    <link href="/img/splashscreens/iphone6_splash.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
    <link href="/img/splashscreens/iphoneplus_splash.png" media="(device-width: 621px) and (device-height: 1104px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image" />
    <link href="/img/splashscreens/iphonex_splash.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image" />
    <link href="/img/splashscreens/iphonexr_splash.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
    <link href="/img/splashscreens/iphonexsmax_splash.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image" />
    <link href="/img/splashscreens/ipad_splash.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
    <link href="/img/splashscreens/ipadpro1_splash.png" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
    <link href="/img/splashscreens/ipadpro3_splash.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
    <link href="/img/splashscreens/ipadpro2_splash.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />

    <link rel="manifest" href="/manifest.json">

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet">
    <style>
        body {
            background: white;
            font-family: 'Prompt', sans-serif;
            /* background-image: url("image/bg.png"); */
            background: #f7c9be;
            background-repeat: no-repeat;
            background-size: 100%;
        }

        .navbar {
            /* display: inline-block;
            list-style-type: none; */
            background: #b6989c;
            /* #5e4aa5 */
        }

        .btn-color {
            background: #b6989c;
            color: white;
        }

        .card-body {
            background: white;
        }

        input {
            width: 100%;
        }

        td {
            padding: 0 !important;
        }

        p {
            padding: 0;
            margin: 0;
        }

        footer {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            background-color: #b6989c;
        }

        .footer-btn {
            color: black;
            background: rgb(244, 215, 215);
            width: 45%;
        }
    </style>
</head>

<body class="color-yellow fixed-top">
    <!-- navbar -->
    <nav class="navbar navbar-light">
        <a class="navbar-brand text-white" href=".">
            HABITRACK
        </a>
    </nav>

    <div class="mb-3">

    </div>
    <!-- container -->
    <div class="container-sm">
        <div class="card">
            <div class="card-body">
                <h3 id="monthName" class="text-center mb-3"></h3>
                <div id="table">
                </div>
            </div>
        </div>
    </div>

    <!-- footer -->
    <footer class="page-footer p-2 text-center">
        <button onclick="goalLoad()" class="btn py-2 footer-btn" data-toggle="modal" data-target="#modal2" href=".">
            ตั้งเป้าหมาย
        </button>
        <button class="btn py-2 footer-btn" data-toggle="modal" data-target="#modal3" href=".">
            ระดับสี
        </button>
        <!-- <button class="btn py-2 footer-btn" data-toggle="modal" data-target="#modal3" href=".">
            อะไรไม่รู้
        </button> -->
        <!-- Copyright -->

    </footer>


    <!-- modal choice -->
    <div class="modal fade" id="modal1" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5>เป้าหมายที่ตั้งไว้</h5>
                </div>
                <div class="modal-body text-center">
                    <div class="row mb-2">
                        <div class="col-6">
                            <div class="card" style="height: 100%;">
                                <div class="card-body" onclick="choice('choice1')" id="choiceOne">
                                    <p id="choice_1"></p>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card" style="height: 100%;">
                                <div class="card-body" onclick="choice('choice2')" id="choiceTwo">
                                    <p id="choice_2"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-6">
                            <div class="card" style="height: 100%;">
                                <div class="card-body" onclick="choice('choice3')" id="choiceThree">
                                    <p id="choice_3"></p>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card" style="height: 100%;">
                                <div class="card-body" onclick="choice('choice4')" id="choiceFour">
                                    <p id="choice_4"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-6">
                            <div class="card" style="height: 100%;">
                                <div class="card-body" onclick="choice('choice5')" id="choiceFive">
                                    <p id="choice_5"></p>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card" style="height: 100%;">
                                <div class="card-body" onclick="choice('choice6')" id="choiceSix">
                                    <p id="choice_6"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer mt-3">
                        <button id="close" onclick="choice('close')" class="btn btn-danger" data-toggle="modal"
                            data-dismiss="modal">บันทึก</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- modal goal -->
    <div class="modal fade" id="modal2" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header mb-3">
                    <h5>ตั้งเป้าหมาย</h5>
                </div>
                <div class="modal-body text-center">
                    <p>*เป้าหมายจะรีเซ็ตเมื่อขึ้นเดือนใหม่</p>
                </div>
                <div class="row">
                    <div class="col-1"></div>
                    <div class="col-10">
                        <input id="goal1" type="text" class="form-control mb-2">
                        <input id="goal2" type="text" class="form-control mb-2">
                        <input id="goal3" type="text" class="form-control mb-2">
                        <input id="goal4" type="text" class="form-control mb-2">
                        <input id="goal5" type="text" class="form-control mb-2">
                        <input id="goal6" type="text" class="form-control mb-2">
                    </div>
                    <div class="col-1"></div>
                </div>
                <div class="modal-footer mt-3">
                    <button onclick="goalSave()" class="btn btn-danger" data-dismiss="modal">บันทึก</button>
                </div>
            </div>
        </div>
    </div>


    <!-- modal color -->
    <div class="modal fade" id="modal3" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header mb-3">
                    <h5>ระดับสีตามจำนวนที่ทำได้</h5>
                </div>
                <div>
                    <div class="row">
                        <div class="col-3"></div>
                        <div class="col-3 mb-3">
                            <div style="background: #bca8d3; width: 20px; height: 20px;">
                            </div>
                        </div>
                        <div class="col-3">
                            <p>1</p>
                        </div>
                        <div class="col-3"></div>
                    </div>
                    <div class="row">
                        <div class="col-3"></div>
                        <div class="col-3 mb-3">
                            <div style="background: #ff7b6c; width: 20px; height: 20px;">
                            </div>
                        </div>
                        <div class="col-3">
                            <p>2</p>
                        </div>
                        <div class="col-3"></div>
                    </div>
                    <div class="row">
                        <div class="col-3"></div>
                        <div class="col-3 mb-3">
                            <div style="background: #ffad93; width: 20px; height: 20px;">
                            </div>
                        </div>
                        <div class="col-3">
                            <p>3</p>
                        </div>
                        <div class="col-3"></div>
                    </div>
                    <div class="row">
                        <div class="col-3"></div>
                        <div class="col-3 mb-3">
                            <div style="background: #ffe094; width: 20px; height: 20px;">
                            </div>
                        </div>
                        <div class="col-3">
                            <p>4</p>
                        </div>
                        <div class="col-3"></div>
                    </div>
                    <div class="row">
                        <div class="col-3"></div>
                        <div class="col-3 mb-3">
                            <div style="background: #88cace; width: 20px; height: 20px;">
                            </div>
                        </div>
                        <div class="col-3">
                            <p>5</p>
                        </div>
                        <div class="col-3"></div>
                    </div>
                    <div class="row">
                        <div class="col-3"></div>
                        <div class="col-3 mb-3">
                            <div style="background: #99d7ae; width: 20px; height: 20px;">
                            </div>
                        </div>
                        <div class="col-3">
                            <p>6</p>
                        </div>
                        <div class="col-3"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" data-dismiss="modal">ปิด</button>
                </div>
            </div>
        </div>
    </div>


    <!-- script -->
    <script>
        var count = 0;
        var total_count = 0;
        var check1 = 1;
        var check2 = 1;
        var check3 = 1;
        var check4 = 1;
        var check5 = 1;
        var check6 = 1;
        var now_day = null;
        var selectArray = []
        var trigger = 0

        window.onload = function() {
            checkMonth()
            choiceLoad()
            setDataLayout()
            addTable()
            setTableColor()
            choiceSet()
        }

        function setDataLayout() {
            if (!localStorage.getItem('data')) {
                let data = {}
                for (let i = 1; i <= getDateMonth(); i++) {
                    data['day' + i] = []
                }
                localStorage.setItem('data', JSON.stringify(data))
                console.log('set data')
            } else {
               
            }
        }   

        function getColor(value) {
            let color = null
            let data = JSON.parse(localStorage.getItem('data'))[value]
            let total_count = 0
            
            try {
                for (let i = 0; i < data.length; i++) {
                total_count += 10
                }
            } catch (error) {
                console.log('no data')
            }
            

            if (total_count == 10) {
                color = "#bca8d3";
            }
            else if (total_count == 20) {
                color = "#ff7b6c";
            }
            else if (total_count == 30) {
                color = "#ffad93";
            }
            else if (total_count == 40) {
                color = "#ffe094";
            }
            else if (total_count == 50) {
                color = "#88cace";
            }
            else if (total_count == 60) {
                color = "#99d7ae";
            }
            return color
        } 

        function setTableColor() {
            for (let i = 1; i <= getDateMonth(); i++) {
                document.getElementById('day' + i).style.background = getColor('day' + i)
            }
        }

        function getDateMonth() {
            let date = new Date()
            let month = date.getMonth()
            let day = null
            if (month == 0 || month == 2 || month == 4 || month == 6 || month == 7 || month == 9 || month == 11) {
                day = 31
            } else if (month == 1) {
                day = 29
            } else {
                day = 30
            }
            return day
        }

        
        function checkMonth() {
            let date = new Date()
            let month = date.getMonth()
            if (!localStorage.getItem('month')) {
                localStorage.setItem('month', month)
            } else {
                let monthdata = localStorage.getItem('month')
                if (monthdata != month) {
                    localStorage.removeItem('data')
                }
            }
        }

        function goalSave() {
            let goal1 = document.getElementById("goal1").value
            let goal2 = document.getElementById("goal2").value
            let goal3 = document.getElementById("goal3").value
            let goal4 = document.getElementById("goal4").value
            let goal5 = document.getElementById("goal5").value
            let goal6 = document.getElementById("goal6").value
            let date = {
                goal1: goal1,
                goal2: goal2,
                goal3: goal3,
                goal4: goal4,
                goal5: goal5,
                goal6: goal6
            }
            localStorage.setItem('goal', JSON.stringify(date))
            console.log('goal save')
            choiceLoad()
        }

        function goalLoad() {
            try {
                let date = JSON.parse(localStorage.getItem('goal'))
                document.getElementById("goal1").value = date.goal1
                document.getElementById("goal2").value = date.goal2
                document.getElementById("goal3").value = date.goal3
                document.getElementById("goal4").value = date.goal4
                document.getElementById("goal5").value = date.goal5
                document.getElementById("goal6").value = date.goal6
                console.log('goal load')
            } catch (error) {
                console.log('empty goal data')
            }
           
        }

        function choiceLoad() {
            try {
                let date = JSON.parse(localStorage.getItem('goal'))
                document.getElementById("choice_1").innerText = date.goal1
                document.getElementById("choice_2").innerText = date.goal2
                document.getElementById("choice_3").innerText = date.goal3
                document.getElementById("choice_4").innerText = date.goal4
                document.getElementById("choice_5").innerText = date.goal5
                document.getElementById("choice_6").innerText = date.goal6
                console.log('load choice data')
            } catch (error) {
                console.log('empty choice data')
            }
            
        }

        // add
        function table_click(id) {
            now_day = id
        }

        function setDayColor(clicked_id) {
            color_id = document.getElementById(clicked_id)
            if (total_count == 10) {
                color_id.style.background = "#bca8d3";
            }
            else if (total_count == 20) {
                color_id.style.background = "#ff7b6c";
            }
            else if (total_count == 30) {
                color_id.style.background = "#ffad93";
            }
            else if (total_count == 40) {
                color_id.style.background = "#ffe094";
            }
            else if (total_count == 50) {
                color_id.style.background = "#88cace";
            }
            else if (total_count == 60) {
                color_id.style.background = "#99d7ae";
            }
        }

        function removeData(value) {
                let index = selectArray.indexOf(value)
                selectArray.splice(index, 1)
            }

        function choice(number) {
            choice1 = document.getElementById("choiceOne");
            choice2 = document.getElementById("choiceTwo");
            choice3 = document.getElementById("choiceThree");
            choice4 = document.getElementById("choiceFour");
            choice5 = document.getElementById("choiceFive");
            choice6 = document.getElementById("choiceSix");
            close = document.getElementById("close");

            if (number == "choice1") {
                if (check1 % 2 == 0) {
                    choice1.style.background = "white";
                    choice1.style.color = "black";
                    count -= 10;
                    check1 += 1;
                    removeData(1)
                    
                } else {
                    choice1.style.background = "#99d7ae";
                    choice1.style.color = "white";
                    count += 10;
                    check1 += 1;
                    selectArray.push(1)
                }
            }
            if (number == "choice2") {
                if (check2 % 2 == 0) {
                    choice2.style.background = "white";
                    choice2.style.color = "black";
                    count -= 10;
                    check2 += 1;
                    removeData(2)
                    
                } else {
                    choice2.style.background = "#99d7ae";
                    choice2.style.color = "white";
                    count += 10;
                    check2 += 1;
                    selectArray.push(2)
                }
            }
            if (number == "choice3") {
                if (check3 % 2 == 0) {
                    choice3.style.background = "white";
                    choice3.style.color = "black";
                    count -= 10;
                    check3 += 1;
                    removeData(3)
                    
                } else {
                    choice3.style.background = "#99d7ae";
                    choice3.style.color = "white";
                    count += 10;
                    check3 += 1;
                    selectArray.push(3)
                }
            }
            if (number == "choice4") {
                if (check4 % 2 == 0) {
                    choice4.style.background = "white";
                    choice4.style.color = "black";
                    count -= 10;
                    check4 += 1;
                    removeData(4)
                } else {
                    choice4.style.background = "#99d7ae";
                    choice4.style.color = "white";
                    count += 10;
                    check4 += 1;
                    selectArray.push(4)
                }
            }
            if (number == "choice5") {
                if (check5 % 2 == 0) {
                    choice5.style.background = "white";
                    choice5.style.color = "black";
                    count -= 10;
                    check5 += 1;
                    removeData(5)
                } else {
                    choice5.style.background = "#99d7ae";
                    choice5.style.color = "white";
                    count += 10;
                    check5 += 1;
                    selectArray.push(5)
                }
            }
            if (number == "choice6") {
                if (check6 % 2 == 0) {
                    choice6.style.background = "white";
                    choice6.style.color = "black";
                    count -= 10;
                    check6 += 1;
                    removeData(6)
                } else {
                    choice6.style.background = "#99d7ae";
                    choice6.style.color = "white";
                    count += 10;
                    check6 += 1;
                    selectArray.push(6)
                }
            }
            if (number == "close") {
                // set data
                let data = JSON.parse(localStorage.getItem('data'))
                data[now_day] = selectArray
                localStorage.setItem('data', JSON.stringify(data))
                total_count = count;
                setDayColor(now_day);
                // reset data
                selectArray = []
                choice1.style.background = "white";
                choice2.style.background = "white";
                choice3.style.background = "white";
                choice4.style.background = "white";
                choice5.style.background = "white";
                choice6.style.background = "white";
                choice1.style.color = "black";
                choice2.style.color = "black";
                choice3.style.color = "black";
                choice4.style.color = "black";
                choice5.style.color = "black";
                choice6.style.color = "black";
                check1 = 1;
                check2 = 1;
                check3 = 1;
                check4 = 1;
                check5 = 1;
                check6 = 1;
                count = 0;
                now_day = null;
            }
            console.log('count', count);
        }

        function addTable() {
            var myTableDiv = document.getElementById("table");

            var table = document.createElement('table');
            table.classList.add("table");
            table.classList.add("table-bordered");

            var tableBody = document.createElement('tbody');
            table.appendChild(tableBody);

            var day = 1;
            var date = new Date();
            var month = date.getMonth();
            // var monthList = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            var monthList = ['มกราคม', 'กุมภาพันธ์', 'มีนาคม', 'เมษายน', 'พฤษภาคม', 'มิถุนายน', 'กรกฎาคม', 'สิงหาคม', 'กันยายน', 'ตุลาคม', 'พฤศจิกายน', 'ธันวาคม'];
            var monthToday = "";
            if (month > 0) {
                monthToday = monthList[month]
            }
            var monthShow = document.getElementById('monthName').innerText = monthToday;
            for (var i = 0; i < 5; i++) {
                var tr = document.createElement('tr');
                tableBody.appendChild(tr);

                for (var j = 0; j < 7; j++) {
                    var input = document.createElement("input");
                    var td = document.createElement('td');
                    if (month == 0 || month == 2 || month == 4 || month == 6 || month == 7 || month == 9 || month == 11) {
                        if (day == 32) {
                            break;
                        } else {
                            td.id = "day" + day++;
                            // add
                            td.setAttribute("onclick", "table_click(this.id)")
                            td.height = '100%';
                            input.setAttribute("type", "button");
                            input.setAttribute("data-toggle", "modal")
                            input.setAttribute("data-target", "#modal1")
                            input.classList.add("btn")
                            // a.appendChild(td)
                            td.appendChild(input)
                            tr.appendChild(td);
                        }
                    } else if (month == 1) {
                        if (day == 30) {
                            break;
                        } else {
                            td.id = "day" + day++;
                            // add
                            td.setAttribute("onclick", "table_click(this.id)")
                            td.height = '100%';
                            input.setAttribute("type", "button");
                            input.setAttribute("data-toggle", "modal")
                            input.setAttribute("data-target", "#modal1")
                            input.classList.add("btn")
                            // a.appendChild(td)
                            td.appendChild(input)
                            tr.appendChild(td);
                        }
                    } else {
                        if (day == 31) {
                            break;
                        } else {
                            td.id = "day" + day++;
                            // add
                            td.setAttribute("onclick", "table_click(this.id)")
                            td.height = '100%';
                            input.setAttribute("type", "button");
                            input.setAttribute("data-toggle", "modal")
                            input.setAttribute("data-target", "#modal1")
                            input.classList.add("btn")
                            // a.appendChild(td)
                            td.appendChild(input)
                            tr.appendChild(td);
                        }
                    }
                }
            }
            myTableDiv.appendChild(table);
        }

        function choiceSet() {
            let targetNode = document.getElementById('modal1');
            let observer = new MutationObserver(function() {
                
                if (targetNode.style.display === 'block' && trigger === 0) {
                    console.log("open modal")
                    trigger = 1
                    // set choice color
                    let data = JSON.parse(localStorage.getItem('data'))[now_day]
                    data.forEach((item) => {
                        choice('choice' + item)
                    })
                } else if (targetNode.style.display === 'none') {
                    console.log("close modal")
                    trigger = 0
                    // reset data
                    let choice1 = document.getElementById("choiceOne");
                    let choice2 = document.getElementById("choiceTwo");
                    let choice3 = document.getElementById("choiceThree");
                    let choice4 = document.getElementById("choiceFour");
                    let choice5 = document.getElementById("choiceFive");
                    let choice6 = document.getElementById("choiceSix");
                    selectArray = []
                    choice1.style.background = "white";
                    choice2.style.background = "white";
                    choice3.style.background = "white";
                    choice4.style.background = "white";
                    choice5.style.background = "white";
                    choice6.style.background = "white";
                    choice1.style.color = "black";
                    choice2.style.color = "black";
                    choice3.style.color = "black";
                    choice4.style.color = "black";
                    choice5.style.color = "black";
                    choice6.style.color = "black";
                    check1 = 1;
                    check2 = 1;
                    check3 = 1;
                    check4 = 1;
                    check5 = 1;
                    check6 = 1;
                    count = 0;
                    now_day = null;
                }
            });
            observer.observe(targetNode, { attributes: true, childList: true });
        }

        function deleteAllData() {
            localStorage.removeItem('month')
            localStorage.removeItem('goal')
            localStorage.removeItem('data')
            location.reload();
        }

    </script>

    <script src="js/jquery-3.4.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
</body>

</html>